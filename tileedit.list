ca65 V2.19 - Git 52e438792
Main file   : main.asm
Current file: main.asm

000000r 1               .org $080D
00080D  1               .segment "STARTUP"
00080D  1               .segment "INIT"
00080D  1               .segment "ONCE"
00080D  1               .segment "CODE"
00080D  1               
00080D  1  4C BE 1B        jmp start
000810  1               
000810  1               .include "x16.inc"
000810  2               .ifndef X16_INC
000810  2               X16_INC  = 1
000810  2               
000810  2               .ifndef __CX16__
000810  2               __CX16__ = 1
000810  2               .endif
000810  2               
000810  2               ; X16 addresses, values, and macros
000810  2               ; Accurate for ROM release R38
000810  2               
000810  2               SD_DEVICE   = 8 ; also host file system on emulator if no SD image mounted
000810  2               DISK_DEVICE = SD_DEVICE ; change if to be loaded off IEC device
000810  2               
000810  2               
000810  2               ; RAM Addresses
000810  2               
000810  2               ; Kernal Registers
000810  2               r0                = $02
000810  2               r0L               = r0
000810  2               r0H               = r0+1
000810  2               r1                = $04
000810  2               r1L               = r1
000810  2               r1H               = r1+1
000810  2               r2                = $06
000810  2               r2L               = r2
000810  2               r2H               = r2+1
000810  2               r3                = $08
000810  2               r3L               = r3
000810  2               r3H               = r3+1
000810  2               r4                = $0A
000810  2               r4L               = r4
000810  2               r4H               = r4+1
000810  2               r5                = $0C
000810  2               r5L               = r5
000810  2               r5H               = r5+1
000810  2               r6                = $0E
000810  2               r6L               = r6
000810  2               r6H               = r6+1
000810  2               r7                = $10
000810  2               r7L               = r7
000810  2               r7H               = r7+1
000810  2               r8                = $12
000810  2               r8L               = r8
000810  2               r8H               = r8+1
000810  2               r9                = $14
000810  2               r9L               = r9
000810  2               r9H               = r9+1
000810  2               r10               = $16
000810  2               r10L              = r10
000810  2               r10H              = r10+1
000810  2               r11               = $18
000810  2               r11L              = r11
000810  2               r11H              = r11+1
000810  2               r12               = $1A
000810  2               r12L              = r12
000810  2               r12H              = r12+1
000810  2               r13               = $1C
000810  2               r13L              = r13
000810  2               r13H              = r13+1
000810  2               r14               = $1E
000810  2               r14L              = r14
000810  2               r14H              = r14+1
000810  2               r15               = $20
000810  2               r15L              = r15
000810  2               r15H              = r15+1
000810  2               
000810  2               ; Zero-Page userspace
000810  2               ZP_PTR_1          = $7E   ; four pointers for temporary use only
000810  2               ZP_PTR_2          = $22
000810  2               ZP_PTR_3          = $24
000810  2               ZP_PTR_4          = $26
000810  2               
000810  2               ; I/O Registers
000810  2               VERA_addr_low     = $9F20
000810  2               VERA_addr_high    = $9F21
000810  2               VERA_addr_bank    = $9F22
000810  2               VERA_data0        = $9F23
000810  2               VERA_data1        = $9F24
000810  2               VERA_ctrl         = $9F25
000810  2               VERA_ien          = $9F26
000810  2               VERA_isr          = $9F27
000810  2               VERA_irqline_l    = $9F28
000810  2               VERA_dc_video     = $9F29 ; VERA_ctrl(1) (DCSEL) = 0
000810  2               VERA_dc_hscale    = $9F2A ; VERA_ctrl(1) (DCSEL) = 0
000810  2               VERA_dc_vscale    = $9F2B ; VERA_ctrl(1) (DCSEL) = 0
000810  2               VERA_dc_border    = $9F2C ; VERA_ctrl(1) (DCSEL) = 0
000810  2               VERA_dc_hstart    = $9F29 ; VERA_ctrl(1) (DCSEL) = 1
000810  2               VERA_dc_hstop     = $9F2A ; VERA_ctrl(1) (DCSEL) = 1
000810  2               VERA_dc_vsstart   = $9F2B ; VERA_ctrl(1) (DCSEL) = 1
000810  2               VERA_dc_vstop     = $9F2C ; VERA_ctrl(1) (DCSEL) = 1
000810  2               VERA_L0_config    = $9F2D
000810  2               VERA_L0_mapbase   = $9F2E
000810  2               VERA_L0_tilebase  = $9F2F
000810  2               VERA_L0_hscroll_l = $9F30
000810  2               VERA_L0_hscroll_h = $9F31
000810  2               VERA_L0_vscroll_l = $9F32
000810  2               VERA_L0_vscroll_h = $9F33
000810  2               VERA_L1_config    = $9F34
000810  2               VERA_L1_mapbase   = $9F35
000810  2               VERA_L1_tilebase  = $9F36
000810  2               VERA_L1_hscroll_l = $9F37
000810  2               VERA_L1_hscroll_h = $9F38
000810  2               VERA_L1_vscroll_l = $9F39
000810  2               VERA_L1_vscroll_h = $9F3A
000810  2               VERA_audio_ctrl   = $9F3B
000810  2               VERA_audio_rate   = $9F3C
000810  2               VERA_audio_data   = $9F3D
000810  2               VERA_spi_data     = $9F3E
000810  2               VERA_spi_ctrl     = $9F3F
000810  2               
000810  2               ROM_BANK          = $01
000810  2               RAM_BANK          = $00
000810  2               
000810  2               YM_reg            = $9F40
000810  2               YM_data           = $9F41
000810  2               
000810  2               ; Emulator Registers
000810  2               GIF_ctrl          = $9FB5
000810  2               
000810  2               ; ROM Banks
000810  2               KERNAL_ROM_BANK   = 0
000810  2               KEYBOARD_ROM_BANK = 1
000810  2               CBDOS_ROM_BANK    = 2
000810  2               GEOS_ROM_BANK     = 3
000810  2               BASIC_ROM_BANK    = 4
000810  2               MONITOR_ROM_BANK  = 5
000810  2               CHARSET_ROM_BANK  = 6
000810  2               
000810  2               ; Banked Addresses
000810  2               RAM_WIN           = $A000
000810  2               RAM_WIN_SIZE      = $2000
000810  2               ROM_WIN           = $C000
000810  2               
000810  2               ; Kernal Subroutines
000810  2               ENTROPY_GET                   := $FECF
000810  2               CONSOLE_set_paging_message    := $FED5
000810  2               CONSOLE_put_image             := $FED8
000810  2               CONSOLE_init                  := $FEDB
000810  2               CONSOLE_put_char              := $FEDE
000810  2               CONSOLE_get_char              := $FEE1
000810  2               MEMORY_FILL                   := $FEE4
000810  2               MEMORY_COPY                   := $FEE7
000810  2               MEMORY_CRC                    := $FEEA
000810  2               MEMORY_DECOMPRESS             := $FEED
000810  2               SPRITE_set_image              := $FEF0
000810  2               SPRITE_set_position           := $FEF3
000810  2               FB_init                       := $FEF6
000810  2               FB_get_info                   := $FEF9
000810  2               FB_set_palette                := $FEFC
000810  2               FB_cursor_position            := $FEFF
000810  2               FB_cursor_next_line           := $FF02
000810  2               FB_get_pixel                  := $FF05
000810  2               FB_get_pixels                 := $FF08
000810  2               FB_set_pixel                  := $FF0B
000810  2               FB_set_pixels                 := $FF0E
000810  2               FB_set_8_pixels               := $FF11
000810  2               FB_set_8_pixels_opaque        := $FF14
000810  2               FB_fill_pixels                := $FF17
000810  2               FB_filter_pixels              := $FF1A
000810  2               FB_move_pixels                := $FF1D
000810  2               GRAPH_init                    := $FF20
000810  2               GRAPH_clear                   := $FF23
000810  2               GRAPH_set_window              := $FF26
000810  2               GRAPH_set_colors              := $FF29
000810  2               GRAPH_draw_line               := $FF2C
000810  2               GRAPH_draw_rect               := $FF2F
000810  2               GRAPH_move_rect               := $FF32
000810  2               GRAPH_draw_oval               := $FF35
000810  2               GRAPH_draw_image              := $FF38
000810  2               GRAPH_set_font                := $FF3B
000810  2               GRAPH_get_char_size           := $FF3E
000810  2               GRAPH_put_char                := $FF41
000810  2               MONITOR                       := $FF44
000810  2               ENTER_BASIC                   := $FF47
000810  2               CLOSE_ALL                     := $FF4A
000810  2               CLOCK_SET_DATE_TIME           := $FF4D
000810  2               CLOCK_GET_DATE_TIME           := $FF50
000810  2               JOYSTICK_SCAN                 := $FF53
000810  2               JOYSTICK_GET                  := $FF56
000810  2               SCREEN_MODE               		:= $FF5F
000810  2               SCREEN_SET_CHARSET            := $FF62
000810  2               PFKEY                         := $FF65
000810  2               MOUSE_CONFIG                  := $FF68
000810  2               MOUSE_GET                     := $FF6B
000810  2               JSRFAR_kernal_addr            := $FF6E
000810  2               MOUSE_SCAN                    := $FF71
000810  2               FETCH                         := $FF74
000810  2               STASH                         := $FF77
000810  2               CMPARE                        := $FF7A
000810  2               PRIMM                         := $FF7D
000810  2               
000810  2               SCINIT                        := $FF81
000810  2               IOINIT                        := $FF84
000810  2               RAMTAS                        := $FF87
000810  2               RESTOR                        := $FF8A
000810  2               LKUPLA                        := $FF8D
000810  2               SETMSG                        := $FF90
000810  2               SECOND                        := $FF93
000810  2               TKSA                          := $FF96
000810  2               MEMTOP                        := $FF99
000810  2               MEMBOT                        := $FF9C
000810  2               SETTMO                        := $FFA2
000810  2               IECIN                         := $FFA5
000810  2               IECOUT                        := $FFA8
000810  2               UNTALK                        := $FFAB
000810  2               UNLISTEN                      := $FFAE
000810  2               LISTEN                        := $FFB1
000810  2               TALK                          := $FFB4
000810  2               READST                        := $FFB7
000810  2               SETLFS                        := $FFBA
000810  2               SETNAM                        := $FFBD
000810  2               OPEN                          := $FFC0
000810  2               CLOSE                         := $FFC3
000810  2               CHKIN                         := $FFC6
000810  2               CHKOUT                        := $FFC9
000810  2               CLRCHN                        := $FFCC
000810  2               CHRIN                         := $FFCF
000810  2               BASIN                         := CHRIN ; alias
000810  2               CHROUT                        := $FFD2
000810  2               BSOUT                         := CHROUT ; alias
000810  2               LOAD                          := $FFD5
000810  2               SAVE                          := $FFD8
000810  2               SETTIM                        := $FFDB
000810  2               RDTIM                         := $FFDE
000810  2               STOP                          := $FFE1
000810  2               GETIN                         := $FFE4
000810  2               CLALL                         := $FFE7
000810  2               UDTIM                         := $FFEA
000810  2               SCREEN                        := $FFED
000810  2               PLOT                          := $FFF0
000810  2               IOBASE                        := $FFF3
000810  2               
000810  2               ; BASIC Vectors
000810  2               BASIC_PANIC       := $C000
000810  2               BASIC_INIT        := $C003
000810  2               
000810  2               
000810  2               ; VRAM Addresses
000810  2               VRAM_petscii   = $0F800
000810  2               VRAM_psg       = $1F9C0
000810  2               VRAM_palette   = $1FA00
000810  2               VRAM_sprattr   = $1FC00
000810  2               
000810  2               ; RAM Vectors
000810  2               IRQVec         := $0314
000810  2               BRKVec         := $0316
000810  2               NMIVec         := $0318
000810  2               FETVec         := $03AF
000810  2               ;STAVec         := TBD
000810  2               ;CMPVec         := TBD
000810  2               
000810  2               
000810  2               ;   Macros
000810  2               
000810  2               .macro VERA_SET_ADDR addr, stride
000810  2                  .ifnblank stride
000810  2                     .if stride < 0
000810  2                        lda #((^addr) | $08 | ((0-stride) << 4))
000810  2                     .else
000810  2                        lda #((^addr) | (stride << 4))
000810  2                     .endif
000810  2                  .else
000810  2                     lda #(^addr) | $10
000810  2                  .endif
000810  2               
000810  2                  sta VERA_addr_bank
000810  2                  lda #(>addr)
000810  2                  sta VERA_addr_high
000810  2                  lda #(<addr)
000810  2                  sta VERA_addr_low
000810  2               .endmacro
000810  2               
000810  2               .macro JSRFAR far_sr_addr, bank
000810  2               	jsr JSRFAR_kernal_addr
000810  2               	.addr far_sr_addr
000810  2               	.byte bank
000810  2               .endmacro
000810  2               
000810  2               .endif
000810  2               
000810  1               .include "charmap.inc"
000810  2               .ifndef CHARMAP_INC
000810  2               CHARMAP_INC = 1
000810  2               
000810  2               ; ASCII-Screen Code character map
000810  2               .charmap $40, $00
000810  2               .charmap $41, $41
000810  2               .charmap $42, $42
000810  2               .charmap $43, $43
000810  2               .charmap $44, $44
000810  2               .charmap $45, $45
000810  2               .charmap $46, $46
000810  2               .charmap $47, $47
000810  2               .charmap $48, $48
000810  2               .charmap $49, $49
000810  2               .charmap $4a, $4a
000810  2               .charmap $4b, $4b
000810  2               .charmap $4c, $4c
000810  2               .charmap $4d, $4d
000810  2               .charmap $4e, $4e
000810  2               .charmap $4f, $4f
000810  2               .charmap $50, $50
000810  2               .charmap $51, $51
000810  2               .charmap $52, $52
000810  2               .charmap $53, $53
000810  2               .charmap $54, $54
000810  2               .charmap $55, $55
000810  2               .charmap $56, $56
000810  2               .charmap $57, $57
000810  2               .charmap $58, $58
000810  2               .charmap $59, $59
000810  2               .charmap $5a, $5a
000810  2               .charmap $5f, $64
000810  2               .charmap $61, $01
000810  2               .charmap $62, $02
000810  2               .charmap $63, $03
000810  2               .charmap $64, $04
000810  2               .charmap $65, $05
000810  2               .charmap $66, $06
000810  2               .charmap $67, $07
000810  2               .charmap $68, $08
000810  2               .charmap $69, $09
000810  2               .charmap $6a, $0a
000810  2               .charmap $6b, $0b
000810  2               .charmap $6c, $0c
000810  2               .charmap $6d, $0d
000810  2               .charmap $6e, $0e
000810  2               .charmap $6f, $0f
000810  2               .charmap $70, $10
000810  2               .charmap $71, $11
000810  2               .charmap $72, $12
000810  2               .charmap $73, $13
000810  2               .charmap $74, $14
000810  2               .charmap $75, $15
000810  2               .charmap $76, $16
000810  2               .charmap $77, $17
000810  2               .charmap $78, $18
000810  2               .charmap $79, $19
000810  2               .charmap $7a, $1a
000810  2               .charmap $7c, $5d
000810  2               
000810  2               .endif
000810  2               
000810  1               .include "initscreen.asm"
000810  2               initscreen:
000810  2               ; menu bar
000810  2               ;  row 0 (upper border)
000810  2  70           .byte $70
000811  2  40 40 40 40  .repeat 3
000815  2  40 40 40 40  
000819  2  40 72 40 40  
00082F  2                  .repeat 9
00082F  2                     .byte $40
00082F  2                  .endrepeat
00082F  2                  .byte $72
00082F  2               .endrepeat
00082F  2  40 40 40 40  .repeat 40
000833  2  40 40 40 40  
000837  2  40 40 40 40  
000857  2                  .byte $40
000857  2               .endrepeat
000857  2  72           .byte $72
000858  2  40 40 40 40  .repeat 7
00085C  2  40 40 40     
00085F  2                  .byte $40
00085F  2               .endrepeat
00085F  2  6E           .byte $6E
000860  2               
000860  2               ;  row 1 (text)
000860  2  5D 20 46 09  .byte "| File    | View    | Options |"
000864  2  0C 05 20 20  
000868  2  20 20 5D 20  
00087F  2  20 20 20 20  .repeat 13
000883  2  20 20 20 20  
000887  2  20 20 20 20  
00088C  2                  .byte " "
00088C  2               .endrepeat
00088C  2  58 31 36 20  .byte "X16 Tile Editor"
000890  2  54 09 0C 05  
000894  2  20 45 04 09  
00089B  2  20 20 20 20  .repeat 12
00089F  2  20 20 20 20  
0008A3  2  20 20 20 20  
0008A7  2                  .byte " "
0008A7  2               .endrepeat
0008A7  2  5D 20 41 02  .byte "| About |"
0008AB  2  0F 15 14 20  
0008AF  2  5D           
0008B0  2               
0008B0  2               ;  row 2 (bottom border)
0008B0  2  6D           .byte $6d
0008B1  2  40 40 40 40  .repeat 2
0008B5  2  40 40 40 40  
0008B9  2  40 71 40 40  
0008C5  2                  .repeat 9
0008C5  2                     .byte $40
0008C5  2                  .endrepeat
0008C5  2                  .byte $71
0008C5  2               .endrepeat
0008C5  2  40 40 40 40  .repeat 9
0008C9  2  40 40 40 40  
0008CD  2  40           
0008CE  2                  .byte $40
0008CE  2               .endrepeat
0008CE  2  7D           .byte $7d
0008CF  2  20 20 20 20  .repeat 40
0008D3  2  20 20 20 20  
0008D7  2  20 20 20 20  
0008F7  2                  .byte " "
0008F7  2               .endrepeat
0008F7  2  6D           .byte $6d
0008F8  2  40 40 40 40  .repeat 7
0008FC  2  40 40 40     
0008FF  2                  .byte $40
0008FF  2               .endrepeat
0008FF  2  7D           .byte $7d
000900  2               
000900  2               ; index controls
000900  2  20 20 20 20  .repeat 20
000904  2  20 20 20 20  
000908  2  20 20 20 20  
000914  2                  .byte " "
000914  2               .endrepeat
000914  2  3C 3C 20 50  .byte "<< Previous       Palette Offset: - 0+              Next >> "
000918  2  12 05 16 09  
00091C  2  0F 15 13 20  
000950  2               
000950  2               ; window upper borders
000950  2  70 40 40 40  .byte $70,$40,$40,$40,$40," Palette ",$40,$40,$40,$6e," ",$70
000954  2  40 20 50 01  
000958  2  0C 05 14 14  
000964  2  40 40 40 40  .repeat 23
000968  2  40 40 40 40  
00096C  2  40 40 40 40  
00097B  2                  .byte $40
00097B  2               .endrepeat
00097B  2  20 54 09 0C  .byte " Tile    0 "
00097F  2  05 20 20 20  
000983  2  20 30 20     
000986  2  40 40 40 40  .repeat 23
00098A  2  40 40 40 40  
00098E  2  40 40 40 40  
00099D  2                  .byte $40
00099D  2               .endrepeat
00099D  2  72 40 6E     .byte $72,$40,$6e
0009A0  2               
0009A0  2               ; mid-windows
0009A0  2               
0009A0  2  5D           .byte "|"
0009A1  2  A0 A0 A0 A0  .repeat 16
0009A5  2  A0 A0 A0 A0  
0009A9  2  A0 A0 A0 A0  
0009B1  2                  .byte $A0
0009B1  2               .endrepeat
0009B1  2  5D 20 5D     .byte "| |"
0009B4  2  A0 A0 A0 A0  .repeat 57
0009B8  2  A0 A0 A0 A0  
0009BC  2  A0 A0 A0 A0  
0009ED  2                  .byte $A0
0009ED  2               .endrepeat
0009ED  2  5D F1 5D     .byte "|",$f1,"|"
0009F0  2               
0009F0  2  5D A0 A0 A0  .repeat 4
0009F4  2  A0 A0 A0 A0  
0009F8  2  A0 A0 A0 A0  
000B30  2                  .byte "|"
000B30  2                  .repeat 16
000B30  2                     .byte $A0
000B30  2                  .endrepeat
000B30  2                  .byte "| |"
000B30  2                  .repeat 57
000B30  2                     .byte $A0
000B30  2                  .endrepeat
000B30  2                  .byte "|",$5e,"|"
000B30  2               .endrepeat
000B30  2               
000B30  2  5D A0 A0 A0  .repeat 11
000B34  2  A0 A0 A0 A0  
000B38  2  A0 A0 A0 A0  
000EA0  2                  .byte "|"
000EA0  2                  .repeat 16
000EA0  2                     .byte $A0
000EA0  2                  .endrepeat
000EA0  2                  .byte "| |"
000EA0  2                  .repeat 57
000EA0  2                     .byte $A0
000EA0  2                  .endrepeat
000EA0  2                  .byte "| |"
000EA0  2               .endrepeat
000EA0  2               
000EA0  2               ; bottom of palette window
000EA0  2  6D           .byte $6d
000EA1  2  40 40 40 40  .repeat 16
000EA5  2  40 40 40 40  
000EA9  2  40 40 40 40  
000EB1  2                  .byte $40
000EB1  2               .endrepeat
000EB1  2  7D 20 5D     .byte $7d," |"
000EB4  2  A0 A0 A0 A0  .repeat 57
000EB8  2  A0 A0 A0 A0  
000EBC  2  A0 A0 A0 A0  
000EED  2                  .byte $A0
000EED  2               .endrepeat
000EED  2  5D 20 5D     .byte "| |"
000EF0  2               
000EF0  2               ; between palette and preview windows
000EF0  2  20 20 70 40  .byte "  ",$70,$40,$40,$40,$6e
000EF4  2  40 40 6E     
000EF7  2  20 20 20 20  .repeat 4
000EFB  2                  .byte " "
000EFB  2               .endrepeat
000EFB  2  70 40 40 40  .byte $70,$40,$40,$40,$6e,"   |"
000EFF  2  6E 20 20 20  
000F03  2  5D           
000F04  2  A0 A0 A0 A0  .repeat 57
000F08  2  A0 A0 A0 A0  
000F0C  2  A0 A0 A0 A0  
000F3D  2                  .byte $A0
000F3D  2               .endrepeat
000F3D  2  5D 20 5D     .byte "| |"
000F40  2               
000F40  2  20 20 5D A0  .byte "  |",$a0,$a0,$a0,"|"
000F44  2  A0 A0 5D     
000F47  2  70 40 40 6E  .byte $70,$40,$40,$6e
000F4B  2  5D A0 A0 A0  .byte "|",$a0,$a0,$a0,"|   |"
000F4F  2  5D 20 20 20  
000F53  2  5D           
000F54  2  A0 A0 A0 A0  .repeat 57
000F58  2  A0 A0 A0 A0  
000F5C  2  A0 A0 A0 A0  
000F8D  2                  .byte $A0
000F8D  2               .endrepeat
000F8D  2  5D 20 5D     .byte "| |"
000F90  2               
000F90  2               
000F90  2  20 20 5D A0  .byte "  |",$a0,$a0,$a0,"|"
000F94  2  A0 A0 5D     
000F97  2  5D 3C 3E 5D  .byte "|<>|"
000F9B  2  5D A0 A0 A0  .byte "|",$a0,$a0,$a0,"|   |"
000F9F  2  5D 20 20 20  
000FA3  2  5D           
000FA4  2  A0 A0 A0 A0  .repeat 57
000FA8  2  A0 A0 A0 A0  
000FAC  2  A0 A0 A0 A0  
000FDD  2                  .byte $A0
000FDD  2               .endrepeat
000FDD  2  5D 20 5D     .byte "| |"
000FE0  2               
000FE0  2  20 20 5D A0  .byte "  |",$a0,$a0,$a0,"|"
000FE4  2  A0 A0 5D     
000FE7  2  6D 40 40 7D  .byte $6d,$40,$40,$7d
000FEB  2  5D A0 A0 A0  .byte "|",$a0,$a0,$a0,"|   |"
000FEF  2  5D 20 20 20  
000FF3  2  5D           
000FF4  2  A0 A0 A0 A0  .repeat 57
000FF8  2  A0 A0 A0 A0  
000FFC  2  A0 A0 A0 A0  
00102D  2                  .byte $A0
00102D  2               .endrepeat
00102D  2  5D 20 5D     .byte "| |"
001030  2               
001030  2  20 20 6B 40  .byte "  ",$6b,$40,$40,$40,$73
001034  2  40 40 73     
001037  2  20 20 20 20  .repeat 4
00103B  2                  .byte " "
00103B  2               .endrepeat
00103B  2  6B 40 40 40  .byte $6b,$40,$40,$40,$73,"   |"
00103F  2  73 20 20 20  
001043  2  5D           
001044  2  A0 A0 A0 A0  .repeat 57
001048  2  A0 A0 A0 A0  
00104C  2  A0 A0 A0 A0  
00107D  2                  .byte $A0
00107D  2               .endrepeat
00107D  2  5D 20 5D     .byte "| |"
001080  2               
001080  2  20 20 5D 20  .byte "  |  1|"
001084  2  20 31 5D     
001087  2  20 20 20 20  .repeat 4
00108B  2                  .byte " "
00108B  2               .endrepeat
00108B  2  5D 20 20 30  .byte "|  0|   |"
00108F  2  5D 20 20 20  
001093  2  5D           
001094  2  A0 A0 A0 A0  .repeat 57
001098  2  A0 A0 A0 A0  
00109C  2  A0 A0 A0 A0  
0010CD  2                  .byte $A0
0010CD  2               .endrepeat
0010CD  2  5D 20 5D     .byte "| |"
0010D0  2               
0010D0  2  20 20 6D 40  .byte "  ",$6d,$40,$40,$40,$7d
0010D4  2  40 40 7D     
0010D7  2  20 20 20 20  .repeat 4
0010DB  2                  .byte " "
0010DB  2               .endrepeat
0010DB  2  6D 40 40 40  .byte $6d,$40,$40,$40,$7d,"   |"
0010DF  2  7D 20 20 20  
0010E3  2  5D           
0010E4  2  A0 A0 A0 A0  .repeat 57
0010E8  2  A0 A0 A0 A0  
0010EC  2  A0 A0 A0 A0  
00111D  2                  .byte $A0
00111D  2               .endrepeat
00111D  2  5D 20 5D     .byte "| |"
001120  2               
001120  2  20 70        .byte " ",$70
001122  2  40 40 40 40  .repeat 7
001126  2  40 40 40     
001129  2                  .byte $40
001129  2               .endrepeat
001129  2  72           .byte $72
00112A  2  40 40 40 40  .repeat 7
00112E  2  40 40 40     
001131  2                  .byte $40
001131  2               .endrepeat
001131  2  6E 20 5D     .byte $6e," |"
001134  2  A0 A0 A0 A0  .repeat 57
001138  2  A0 A0 A0 A0  
00113C  2  A0 A0 A0 A0  
00116D  2                  .byte $A0
00116D  2               .endrepeat
00116D  2  5D 20 5D     .byte "| |"
001170  2               
001170  2  20 5D 44 12  .byte " |Dropper| "
001174  2  0F 10 10 05  
001178  2  12 5D 20     
00117B  2  43 0C 05 01  .byte "Clear | |"
00117F  2  12 20 5D 20  
001183  2  5D           
001184  2  A0 A0 A0 A0  .repeat 57
001188  2  A0 A0 A0 A0  
00118C  2  A0 A0 A0 A0  
0011BD  2                  .byte $A0
0011BD  2               .endrepeat
0011BD  2  5D 20 5D     .byte "| |"
0011C0  2               
0011C0  2  20 6B        .byte " ",$6b
0011C2  2  40 40 40 40  .repeat 7
0011C6  2  40 40 40     
0011C9  2                  .byte $40
0011C9  2               .endrepeat
0011C9  2  5B           .byte $5b
0011CA  2  40 40 40 40  .repeat 7
0011CE  2  40 40 40     
0011D1  2                  .byte $40
0011D1  2               .endrepeat
0011D1  2  73 20 5D     .byte $73," |"
0011D4  2  A0 A0 A0 A0  .repeat 57
0011D8  2  A0 A0 A0 A0  
0011DC  2  A0 A0 A0 A0  
00120D  2                  .byte $A0
00120D  2               .endrepeat
00120D  2  5D 20 5D     .byte "| |"
001210  2               
001210  2  20 5D 20 43  .byte " | Copy  | "
001214  2  0F 10 19 20  
001218  2  20 5D 20     
00121B  2  50 01 13 14  .byte "Paste | |"
00121F  2  05 20 5D 20  
001223  2  5D           
001224  2  A0 A0 A0 A0  .repeat 57
001228  2  A0 A0 A0 A0  
00122C  2  A0 A0 A0 A0  
00125D  2                  .byte $A0
00125D  2               .endrepeat
00125D  2  5D 20 5D     .byte "| |"
001260  2               
001260  2  20 6D        .byte " ",$6d
001262  2  40 40 40 40  .repeat 7
001266  2  40 40 40     
001269  2                  .byte $40
001269  2               .endrepeat
001269  2  71           .byte $71
00126A  2  40 40 40 40  .repeat 7
00126E  2  40 40 40     
001271  2                  .byte $40
001271  2               .endrepeat
001271  2  7D 20 5D     .byte $7d," |"
001274  2  A0 A0 A0 A0  .repeat 57
001278  2  A0 A0 A0 A0  
00127C  2  A0 A0 A0 A0  
0012AD  2                  .byte $A0
0012AD  2               .endrepeat
0012AD  2  5D 20 5D     .byte "| |"
0012B0  2               
0012B0  2  20 20 20 20  .repeat 8
0012B4  2  20 20 20 20  
0012B8  2                  .byte " "
0012B8  2               .endrepeat
0012B8  2  70 40 6E     .byte $70,$40,$6e
0012BB  2  20 20 20 20  .repeat 8
0012BF  2  20 20 20 20  
0012C3  2                  .byte " "
0012C3  2               .endrepeat
0012C3  2  5D           .byte "|"
0012C4  2  A0 A0 A0 A0  .repeat 57
0012C8  2  A0 A0 A0 A0  
0012CC  2  A0 A0 A0 A0  
0012FD  2                  .byte $A0
0012FD  2               .endrepeat
0012FD  2  5D 20 5D     .byte "| |"
001300  2               
001300  2  20 20 20 20  .repeat 8
001304  2  20 20 20 20  
001308  2                  .byte " "
001308  2               .endrepeat
001308  2  5D F1 5D     .byte "|",$f1,"|"
00130B  2  20 20 20 20  .repeat 8
00130F  2  20 20 20 20  
001313  2                  .byte " "
001313  2               .endrepeat
001313  2  5D           .byte "|"
001314  2  A0 A0 A0 A0  .repeat 57
001318  2  A0 A0 A0 A0  
00131C  2  A0 A0 A0 A0  
00134D  2                  .byte $A0
00134D  2               .endrepeat
00134D  2  5D 20 5D     .byte "| |"
001350  2               
001350  2  20 20 20 20  .repeat 4
001354  2                  .byte " "
001354  2               .endrepeat
001354  2  70 40 72 40  .byte $70,$40,$72,$40,$71,$40,$71,$40,$72,$40,$6e
001358  2  71 40 71 40  
00135C  2  72 40 6E     
00135F  2  20 20 20 20  .repeat 4
001363  2                  .byte " "
001363  2               .endrepeat
001363  2  5D           .byte "|"
001364  2  A0 A0 A0 A0  .repeat 57
001368  2  A0 A0 A0 A0  
00136C  2  A0 A0 A0 A0  
00139D  2                  .byte $A0
00139D  2               .endrepeat
00139D  2  5D 20 5D     .byte "| |"
0013A0  2               
0013A0  2  20 20 20 20  .repeat 4
0013A4  2                  .byte " "
0013A4  2               .endrepeat
0013A4  2  5D F3 5D 53  .byte "|",$f3,"|Shift|",$f0,"|"
0013A8  2  08 09 06 14  
0013AC  2  5D F0 5D     
0013AF  2  20 20 20 20  .repeat 4
0013B3  2                  .byte " "
0013B3  2               .endrepeat
0013B3  2  5D           .byte "|"
0013B4  2  A0 A0 A0 A0  .repeat 57
0013B8  2  A0 A0 A0 A0  
0013BC  2  A0 A0 A0 A0  
0013ED  2                  .byte $A0
0013ED  2               .endrepeat
0013ED  2  5D 20 5D     .byte "| |"
0013F0  2               
0013F0  2  20 20 20 20  .repeat 4
0013F4  2                  .byte " "
0013F4  2               .endrepeat
0013F4  2  6D 40 71 40  .byte $6d,$40,$71,$40,$72,$40,$72,$40,$71,$40,$7d
0013F8  2  72 40 72 40  
0013FC  2  71 40 7D     
0013FF  2  20 20 20 20  .repeat 4
001403  2                  .byte " "
001403  2               .endrepeat
001403  2  5D           .byte "|"
001404  2  A0 A0 A0 A0  .repeat 57
001408  2  A0 A0 A0 A0  
00140C  2  A0 A0 A0 A0  
00143D  2                  .byte $A0
00143D  2               .endrepeat
00143D  2  5D 20 5D     .byte "| |"
001440  2               
001440  2  20 20 20 20  .repeat 8
001444  2  20 20 20 20  
001448  2                  .byte " "
001448  2               .endrepeat
001448  2  5D F2 5D     .byte "|",$f2,"|"
00144B  2  20 20 20 20  .repeat 8
00144F  2  20 20 20 20  
001453  2                  .byte " "
001453  2               .endrepeat
001453  2  5D           .byte "|"
001454  2  A0 A0 A0 A0  .repeat 57
001458  2  A0 A0 A0 A0  
00145C  2  A0 A0 A0 A0  
00148D  2                  .byte $A0
00148D  2               .endrepeat
00148D  2  5D 20 5D     .byte "| |"
001490  2               
001490  2  20 20 20 20  .repeat 8
001494  2  20 20 20 20  
001498  2                  .byte " "
001498  2               .endrepeat
001498  2  6D 40 7D     .byte $6d,$40,$7d
00149B  2  20 20 20 20  .repeat 8
00149F  2  20 20 20 20  
0014A3  2                  .byte " "
0014A3  2               .endrepeat
0014A3  2  5D           .byte "|"
0014A4  2  A0 A0 A0 A0  .repeat 57
0014A8  2  A0 A0 A0 A0  
0014AC  2  A0 A0 A0 A0  
0014DD  2                  .byte $A0
0014DD  2               .endrepeat
0014DD  2  5D 20 5D     .byte "| |"
0014E0  2               
0014E0  2               ; top of preview window
0014E0  2  70 40 40 40  .byte $70,$40,$40,$40,$40," Preview ",$40,$40,$40,$6e," |"
0014E4  2  40 20 50 12  
0014E8  2  05 16 09 05  
0014F4  2  A0 A0 A0 A0  .repeat 57
0014F8  2  A0 A0 A0 A0  
0014FC  2  A0 A0 A0 A0  
00152D  2                  .byte $A0
00152D  2               .endrepeat
00152D  2  5D 20 5D     .byte "| |"
001530  2               
001530  2               ; mid-windows
001530  2  5D 20 20 20  .repeat 8
001534  2  20 20 20 20  
001538  2  20 20 20 20  
0017B0  2                  .byte "|"
0017B0  2                  .repeat 16
0017B0  2                     .byte " "
0017B0  2                  .endrepeat
0017B0  2                  .byte "| |"
0017B0  2                  .repeat 57
0017B0  2                     .byte $A0
0017B0  2                  .endrepeat
0017B0  2                  .byte "| |"
0017B0  2               .endrepeat
0017B0  2               
0017B0  2               ; bottom preview window
0017B0  2  6D           .byte $6d
0017B1  2  40 40 40 40  .repeat 16
0017B5  2  40 40 40 40  
0017B9  2  40 40 40 40  
0017C1  2                  .byte $40
0017C1  2               .endrepeat
0017C1  2  7D 20 5D     .byte $7d," |"
0017C4  2  A0 A0 A0 A0  .repeat 57
0017C8  2  A0 A0 A0 A0  
0017CC  2  A0 A0 A0 A0  
0017FD  2                  .byte $A0
0017FD  2               .endrepeat
0017FD  2  5D 20 5D     .byte "| |"
001800  2               
001800  2  20 41 04 04  .byte " Address: $00000"
001804  2  12 05 13 13  
001808  2  3A 20 24 30  
001810  2  20 20 20     .repeat 3
001813  2                  .byte " "
001813  2               .endrepeat
001813  2  5D           .byte "|"
001814  2  A0 A0 A0 A0  .repeat 57
001818  2  A0 A0 A0 A0  
00181C  2  A0 A0 A0 A0  
00184D  2                  .byte $A0
00184D  2               .endrepeat
00184D  2  5D 20 5D     .byte "| |"
001850  2               
001850  2  20 57 09 04  .byte " Width:  16"
001854  2  14 08 3A 20  
001858  2  20 31 36     
00185B  2  20 20 20 20  .repeat 8
00185F  2  20 20 20 20  
001863  2                  .byte " "
001863  2               .endrepeat
001863  2  5D           .byte "|"
001864  2  A0 A0 A0 A0  .repeat 57
001868  2  A0 A0 A0 A0  
00186C  2  A0 A0 A0 A0  
00189D  2                  .byte $A0
00189D  2               .endrepeat
00189D  2  5D 20 5D     .byte "| |"
0018A0  2               
0018A0  2  20 48 05 09  .byte " Height: 16"
0018A4  2  07 08 14 3A  
0018A8  2  20 31 36     
0018AB  2  20 20 20 20  .repeat 8
0018AF  2  20 20 20 20  
0018B3  2                  .byte " "
0018B3  2               .endrepeat
0018B3  2  5D           .byte "|"
0018B4  2  A0 A0 A0 A0  .repeat 57
0018B8  2  A0 A0 A0 A0  
0018BC  2  A0 A0 A0 A0  
0018ED  2                  .byte $A0
0018ED  2               .endrepeat
0018ED  2  5D 20 5D     .byte "| |"
0018F0  2               
0018F0  2  20 43 0F 0C  .byte " Color Depth:  16"
0018F4  2  0F 12 20 44  
0018F8  2  05 10 14 08  
001901  2  20 20        .repeat 2
001903  2                  .byte " "
001903  2               .endrepeat
001903  2  5D           .byte "|"
001904  2  A0 A0 A0 A0  .repeat 57
001908  2  A0 A0 A0 A0  
00190C  2  A0 A0 A0 A0  
00193D  2                  .byte $A0
00193D  2               .endrepeat
00193D  2  5D 20 5D     .byte "| |"
001940  2               
001940  2  20 48 2D 46  .byte " H-Flip: Off"
001944  2  0C 09 10 3A  
001948  2  20 4F 06 06  
00194C  2  20 20 20 20  .repeat 7
001950  2  20 20 20     
001953  2                  .byte " "
001953  2               .endrepeat
001953  2  5D           .byte "|"
001954  2  A0 A0 A0 A0  .repeat 57
001958  2  A0 A0 A0 A0  
00195C  2  A0 A0 A0 A0  
00198D  2                  .byte $A0
00198D  2               .endrepeat
00198D  2  5D 20 5D     .byte "| |"
001990  2               
001990  2  20 56 2D 46  .byte " V-Flip: Off"
001994  2  0C 09 10 3A  
001998  2  20 4F 06 06  
00199C  2  20 20 20 20  .repeat 7
0019A0  2  20 20 20     
0019A3  2                  .byte " "
0019A3  2               .endrepeat
0019A3  2  5D           .byte "|"
0019A4  2  A0 A0 A0 A0  .repeat 57
0019A8  2  A0 A0 A0 A0  
0019AC  2  A0 A0 A0 A0  
0019DD  2                  .byte $A0
0019DD  2               .endrepeat
0019DD  2  5D F2 5D     .byte "|",$f2,"|"
0019E0  2               
0019E0  2               ; bottom scrollbar
0019E0  2               ;   row 77 - top
0019E0  2  20 20 20 20  .repeat 19
0019E4  2  20 20 20 20  
0019E8  2  20 20 20 20  
0019F3  2                  .byte " "
0019F3  2               .endrepeat
0019F3  2  6B           .byte $6b
0019F4  2  40 40 40 40  .repeat 57
0019F8  2  40 40 40 40  
0019FC  2  40 40 40 40  
001A2D  2                  .byte $40
001A2D  2               .endrepeat
001A2D  2  5B 40 73     .byte $5b,$40,$73
001A30  2               
001A30  2               ;  row 78 - middle
001A30  2  20 20 20 20  .repeat 19
001A34  2  20 20 20 20  
001A38  2  20 20 20 20  
001A43  2                  .byte " "
001A43  2               .endrepeat
001A43  2  5D F3 5E 5E  .byte "|",$f3,$5e,$5e,$5e,$5e
001A47  2  5E 5E        
001A49  2  20 20 20 20  .repeat 51
001A4D  2  20 20 20 20  
001A51  2  20 20 20 20  
001A7C  2                  .byte " "
001A7C  2               .endrepeat
001A7C  2  F0 5D 20 5D  .byte $f0,"| |"
001A80  2               
001A80  2               ; row 79 - bottom
001A80  2  20 20 20 20  .repeat 19
001A84  2  20 20 20 20  
001A88  2  20 20 20 20  
001A93  2                  .byte " "
001A93  2               .endrepeat
001A93  2  6D           .byte $6d
001A94  2  40 40 40 40  .repeat 57
001A98  2  40 40 40 40  
001A9C  2  40 40 40 40  
001ACD  2                  .byte $40
001ACD  2               .endrepeat
001ACD  2  71 40 7D     .byte $71,$40,$7d
001AD0  2               
001AD0  2               arrowheads:
001AD0  2  C0           .byte %11000000
001AD1  2  F0           .byte %11110000
001AD2  2  FC           .byte %11111100
001AD3  2  FF           .byte %11111111
001AD4  2  FF           .byte %11111111
001AD5  2  FC           .byte %11111100
001AD6  2  F0           .byte %11110000
001AD7  2  C0           .byte %11000000
001AD8  2               
001AD8  2  18           .byte %00011000
001AD9  2  18           .byte %00011000
001ADA  2  3C           .byte %00111100
001ADB  2  3C           .byte %00111100
001ADC  2  7E           .byte %01111110
001ADD  2  7E           .byte %01111110
001ADE  2  FF           .byte %11111111
001ADF  2  FF           .byte %11111111
001AE0  2               
001AE0  2  FF           .byte %11111111
001AE1  2  FF           .byte %11111111
001AE2  2  7E           .byte %01111110
001AE3  2  7E           .byte %01111110
001AE4  2  3C           .byte %00111100
001AE5  2  3C           .byte %00111100
001AE6  2  18           .byte %00011000
001AE7  2  18           .byte %00011000
001AE8  2               
001AE8  2  03           .byte %00000011
001AE9  2  0F           .byte %00001111
001AEA  2  3F           .byte %00111111
001AEB  2  FF           .byte %11111111
001AEC  2  FF           .byte %11111111
001AED  2  3F           .byte %00111111
001AEE  2  0F           .byte %00001111
001AEF  2  03           .byte %00000011
001AF0  2               
001AF0  2               TEXT_START = $1B000
001AF0  2               PAL_VIZ = TEXT_START+$503
001AF0  2               FG_COLOR_BOX = TEXT_START+$1707
001AF0  2               BG_COLOR_BOX = TEXT_START+$1719
001AF0  2               
001AF0  2               load_initscreen:
001AF0  2  A9 0E           lda #$0E  ; go to lowercase
001AF2  2  20 D2 FF        jsr CHROUT
001AF5  2                  ; TODO: make sure that layer 1 is moved to default position
001AF5  2  A9 68           lda #$68 ; 128x64 T256C
001AF7  2  8D 34 9F        sta VERA_L1_config
001AFA  2                  ; put arrowheads into character set
001AFA  2  9C 25 9F        stz VERA_ctrl
001AFD  2  A9 11 8D 22     VERA_SET_ADDR $1F780,1
001B01  2  9F A9 F7 8D  
001B05  2  21 9F A9 80  
001B0C  2  A9 D0           lda #<arrowheads
001B0E  2  85 7E           sta ZP_PTR_1
001B10  2  A9 1A           lda #>arrowheads
001B12  2  85 7F           sta ZP_PTR_1+1
001B14  2  A0 00           ldy #0
001B16  2               @ah_loop1:
001B16  2  B1 7E           lda (ZP_PTR_1),y
001B18  2  8D 23 9F        sta VERA_data0
001B1B  2  C8              iny
001B1C  2  C0 20           cpy #32
001B1E  2  D0 F6           bne @ah_loop1
001B20  2  A0 00           ldy #0
001B22  2               @ah_loop2:
001B22  2  B1 7E           lda (ZP_PTR_1),y
001B24  2  49 FF           eor #$FF ; reverse video
001B26  2  8D 23 9F        sta VERA_data0
001B29  2  C8              iny
001B2A  2  C0 20           cpy #32
001B2C  2  D0 F4           bne @ah_loop2
001B2E  2                  ; load into layer 1 tile map
001B2E  2  A9 11 8D 22     VERA_SET_ADDR TEXT_START,1
001B32  2  9F A9 B0 8D  
001B36  2  21 9F A9 00  
001B3D  2  A9 10           lda #<initscreen
001B3F  2  85 7E           sta ZP_PTR_1
001B41  2  A9 08           lda #>initscreen
001B43  2  85 7F           sta ZP_PTR_1+1
001B45  2  A0 00           ldy #0
001B47  2  A2 3C           ldx #60
001B49  2               @loop:
001B49  2  B1 7E           lda (ZP_PTR_1),y
001B4B  2  8D 23 9F        sta VERA_data0
001B4E  2  A9 01           lda #1
001B50  2  8D 23 9F        sta VERA_data0
001B53  2  C8              iny
001B54  2  C0 50           cpy #80
001B56  2  D0 F1           bne @loop
001B58  2  A0 00           ldy #0
001B5A  2  EE 21 9F        inc VERA_addr_high
001B5D  2  9C 20 9F        stz VERA_addr_low
001B60  2  A5 7E           lda ZP_PTR_1
001B62  2  18              clc
001B63  2  69 50           adc #80
001B65  2  85 7E           sta ZP_PTR_1
001B67  2  A5 7F           lda ZP_PTR_1+1
001B69  2  69 00           adc #0
001B6B  2  85 7F           sta ZP_PTR_1+1
001B6D  2  CA              dex
001B6E  2  D0 D9           bne @loop
001B70  2                  ; load current palette
001B70  2  A9 21 8D 22     VERA_SET_ADDR PAL_VIZ,2
001B74  2  9F A9 B5 8D  
001B78  2  21 9F A9 03  
001B7F  2  A2 00           ldx #0
001B81  2  A0 00           ldy #0
001B83  2               @pal_loop:
001B83  2  8E 23 9F        stx VERA_data0
001B86  2  C8              iny
001B87  2  C0 10           cpy #16
001B89  2  D0 0A           bne @next_color
001B8B  2  A0 00           ldy #0
001B8D  2  EE 21 9F        inc VERA_addr_high
001B90  2  A9 03           lda #<PAL_VIZ
001B92  2  8D 20 9F        sta VERA_addr_low
001B95  2               @next_color:
001B95  2  E8              inx
001B96  2  D0 EB           bne @pal_loop
001B98  2                  ; load background color (0)
001B98  2  A9 21 8D 22     VERA_SET_ADDR BG_COLOR_BOX,2
001B9C  2  9F A9 C7 8D  
001BA0  2  21 9F A9 19  
001BA7  2  A2 03           ldx #3
001BA9  2               @bgc_loop:
001BA9  2  9C 23 9F        stz VERA_data0
001BAC  2  9C 23 9F        stz VERA_data0
001BAF  2  9C 23 9F        stz VERA_data0
001BB2  2  EE 21 9F        inc VERA_addr_high
001BB5  2  A9 19           lda #<BG_COLOR_BOX
001BB7  2  8D 20 9F        sta VERA_addr_low
001BBA  2  CA              dex
001BBB  2  D0 EC           bne @bgc_loop
001BBD  2  60              rts
001BBE  2               
001BBE  1               
001BBE  1               TILE_MAP = $1A800
001BBE  1               
001BBE  1               start:
001BBE  1  20 F0 1A        jsr load_initscreen
001BC1  1                  ; setup layer 0 as work layer, using default settings
001BC1  1  A9 02           lda #$02 ; 32x32 4bpp
001BC3  1  8D 2D 9F        sta VERA_L0_config
001BC6  1  A9 D4           lda #(TILE_MAP>>9)
001BC8  1  8D 2E 9F        sta VERA_L0_mapbase
001BCB  1  A9 03           lda #$03 ; tilebase $00000, 16x16 tiles
001BCD  1  8D 2F 9F        sta VERA_L0_tilebase
001BD0  1                  ; load tile 0
001BD0  1               
001BD0  1               @loop:
001BD0  1  CB              wai
001BD1  1  80 FD           bra @loop
001BD3  1  60              rts
001BD3  1               
